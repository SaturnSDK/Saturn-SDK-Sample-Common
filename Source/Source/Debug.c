#include <Debug.h>
#include <VDP.h>

uint16_t DBG_Palette [ 256 ] =
{
	0x0000, 0x5400, 0x02A0, 0x56A0, 0x0015, 0x5415, 0x0155, 0x56B5,
	0x294A, 0x7D4A, 0x2BEA, 0x7FEA, 0x295F, 0x7D5F, 0x2BFF, 0x7FFF,
	0x0000, 0x0842, 0x1084, 0x14A5, 0x1CE7, 0x2108, 0x294A, 0x318C,
	0x39CE, 0x4210, 0x4A52, 0x5294, 0x5AD6, 0x6739, 0x739C, 0x7FFF, 
	0x7C00, 0x7C08, 0x7C0F, 0x7C17, 0x7C1F, 0x5C1F, 0x3C1F, 0x201F,
	0x001F, 0x011F, 0x01FF, 0x02FF, 0x03FF, 0x03F7, 0x03EF, 0x03E8, 
	0x03E0, 0x23E0, 0x3FE0, 0x5FE0, 0x7FE0, 0x7EE0, 0x7DE0, 0x7D00,
	0x7DEF, 0x7DF3, 0x7DF7, 0x7DFB, 0x7DFF, 0x6DFF, 0x5DFF, 0x4DFF, 
	0x3DFF, 0x3E7F, 0x3EFF, 0x3F7F, 0x3FFF, 0x3FFB, 0x3FF7, 0x3FF3,
	0x3FEF, 0x4FEF, 0x5FEF, 0x6FEF, 0x7FEF, 0x7F6F, 0x7EEF, 0x7E6F, 
	0x7ED6, 0x7ED8, 0x7EDB, 0x7EDD, 0x7EDF, 0x76DF, 0x6EDF, 0x62DF,
	0x5ADF, 0x5B1F, 0x5B7F, 0x5BBF, 0x5BFF, 0x5BFD, 0x5BFB, 0x5BF8, 
	0x5BF6, 0x63F6, 0x6FF6, 0x77F6, 0x7FF6, 0x7FB6, 0x7F76, 0x7F16,
	0x3800, 0x3803, 0x3807, 0x380A, 0x380E, 0x280E, 0x1C0E, 0x0C0E, 
	0x000E, 0x006E, 0x00EE, 0x014E, 0x01CE, 0x01CA, 0x01C7, 0x01C3,
	0x01C0, 0x0DC0, 0x1DC0, 0x29C0, 0x39C0, 0x3940, 0x38E0, 0x3860, 
	0x38E7, 0x38E8, 0x38EA, 0x38EC, 0x38EE, 0x30EE, 0x28EE, 0x20EE,
	0x1CEE, 0x1D0E, 0x1D4E, 0x1D8E, 0x1DCE, 0x1DCC, 0x1DCA, 0x1DC8, 
	0x1DC7, 0x21C7, 0x29C7, 0x31C7, 0x39C7, 0x3987, 0x3947, 0x3907,
	0x394A, 0x394B, 0x394C, 0x394D, 0x394E, 0x354E, 0x314E, 0x2D4E, 
	0x294E, 0x296E, 0x298E, 0x29AE, 0x29CE, 0x29CD, 0x29CC, 0x29CB,
	0x29CA, 0x2DCA, 0x31CA, 0x35CA, 0x39CA, 0x39AA, 0x398A, 0x396A, 
	0x2000, 0x2002, 0x2004, 0x2006, 0x2008, 0x1808, 0x1008, 0x0808,
	0x0008, 0x0048, 0x0088, 0x00C8, 0x0108, 0x0106, 0x0104, 0x0102,
	0x0100, 0x0900, 0x1100, 0x1900, 0x2100, 0x20C0, 0x2080, 0x2040,
	0x2084, 0x2085, 0x2086, 0x2087, 0x2088, 0x1C88, 0x1888, 0x1488, 
	0x1088, 0x10A8, 0x10C8, 0x10E8, 0x1108, 0x1107, 0x1106, 0x1105,
	0x1104, 0x1504, 0x1904, 0x1D04, 0x2104, 0x20E4, 0x20C4, 0x20A4, 
	0x20A5, 0x20A6, 0x20A6, 0x20A7, 0x20A8, 0x1CA8, 0x18A8, 0x18A8,
	0x14A8, 0x14C8, 0x14C8, 0x14E8, 0x1508, 0x1507, 0x1506, 0x1506, 
    0x1505, 0x1905, 0x1905, 0x1D05, 0x2105, 0x20E5, 0x20C5, 0x20C5,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000
};

uint8_t DBG_Font [ ] =
{
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 0x7E, 0x81, 0xA5, 0x81, 0xBD, 0x99, 0x81, 0x7E,
	 0x7E, 0xFF, 0xDB, 0xFF, 0xC3, 0xE7, 0xFF, 0x7E,
	 0x6C, 0xFE, 0xFE, 0xFE, 0x7C, 0x38, 0x10, 0x00,
	 0x10, 0x38, 0x7C, 0xFE, 0x7C, 0x38, 0x10, 0x00,
	 0x38, 0x7C, 0x38, 0xFE, 0xFE, 0x7C, 0x38, 0x7C,
	 0x10, 0x10, 0x38, 0x7C, 0xFE, 0x7C, 0x38, 0x7C,
	 0x00, 0x00, 0x18, 0x3C, 0x3C, 0x18, 0x00, 0x00,
	 0xFF, 0xFF, 0xE7, 0xC3, 0xC3, 0xE7, 0xFF, 0xFF,
	 0x00, 0x3C, 0x66, 0x42, 0x42, 0x66, 0x3C, 0x00,
	 0xFF, 0xC3, 0x99, 0xBD, 0xBD, 0x99, 0xC3, 0xFF,
	 0x0F, 0x07, 0x0F, 0x7D, 0xCC, 0xCC, 0xCC, 0x78,
	 0x3C, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x7E, 0x18,
	 0x3F, 0x33, 0x3F, 0x30, 0x30, 0x70, 0xF0, 0xE0,
	 0x7F, 0x63, 0x7F, 0x63, 0x63, 0x67, 0xE6, 0xC0,
	 0x99, 0x5A, 0x3C, 0xE7, 0xE7, 0x3C, 0x5A, 0x99,
	 0x80, 0xE0, 0xF8, 0xFE, 0xF8, 0xE0, 0x80, 0x00,
	 0x02, 0x0E, 0x3E, 0xFE, 0x3E, 0x0E, 0x02, 0x00,
	 0x18, 0x3C, 0x7E, 0x18, 0x18, 0x7E, 0x3C, 0x18,
	 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x66, 0x00,
	 0x7F, 0xDB, 0xDB, 0x7B, 0x1B, 0x1B, 0x1B, 0x00,
	 0x3E, 0x63, 0x38, 0x6C, 0x6C, 0x38, 0xCC, 0x78,
	 0x00, 0x00, 0x00, 0x00, 0x7E, 0x7E, 0x7E, 0x00,
	 0x18, 0x3C, 0x7E, 0x18, 0x7E, 0x3C, 0x18, 0xFF,
	 0x18, 0x3C, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x00,
	 0x18, 0x18, 0x18, 0x18, 0x7E, 0x3C, 0x18, 0x00,
	 0x00, 0x18, 0x0C, 0xFE, 0x0C, 0x18, 0x00, 0x00,
	 0x00, 0x30, 0x60, 0xFE, 0x60, 0x30, 0x00, 0x00,
	 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xFE, 0x00, 0x00,
	 0x00, 0x24, 0x66, 0xFF, 0x66, 0x24, 0x00, 0x00,
	 0x00, 0x18, 0x3C, 0x7E, 0xFF, 0xFF, 0x00, 0x00,
	 0x00, 0xFF, 0xFF, 0x7E, 0x3C, 0x18, 0x00, 0x00,
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 0x30, 0x78, 0x78, 0x78, 0x30, 0x00, 0x30, 0x00,
	 0x6C, 0x6C, 0x6C, 0x00, 0x00, 0x00, 0x00, 0x00,
	 0x6C, 0x6C, 0xFE, 0x6C, 0xFE, 0x6C, 0x6C, 0x00,
	 0x30, 0x7C, 0xC0, 0x78, 0x0C, 0xF8, 0x30, 0x00,
	 0x00, 0xC6, 0xCC, 0x18, 0x30, 0x66, 0xC6, 0x00,
	 0x38, 0x6C, 0x38, 0x76, 0xDC, 0xCC, 0x76, 0x00,
	 0x60, 0x60, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00,
	 0x18, 0x30, 0x60, 0x60, 0x60, 0x30, 0x18, 0x00,
	 0x60, 0x30, 0x18, 0x18, 0x18, 0x30, 0x60, 0x00,
	 0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00,
	 0x00, 0x30, 0x30, 0xFC, 0x30, 0x30, 0x00, 0x00,
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x60,
	 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0x00, 0x00,
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x00,
	 0x06, 0x0C, 0x18, 0x30, 0x60, 0xC0, 0x80, 0x00,
	 0x7C, 0xC6, 0xCE, 0xDE, 0xF6, 0xE6, 0x7C, 0x00,
	 0x30, 0x70, 0x30, 0x30, 0x30, 0x30, 0xFC, 0x00,
	 0x78, 0xCC, 0x0C, 0x38, 0x60, 0xCC, 0xFC, 0x00,
	 0x78, 0xCC, 0x0C, 0x38, 0x0C, 0xCC, 0x78, 0x00,
	 0x1C, 0x3C, 0x6C, 0xCC, 0xFE, 0x0C, 0x1E, 0x00,
	 0xFC, 0xC0, 0xF8, 0x0C, 0x0C, 0xCC, 0x78, 0x00,
	 0x38, 0x60, 0xC0, 0xF8, 0xCC, 0xCC, 0x78, 0x00,
	 0xFC, 0xCC, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00,
	 0x78, 0xCC, 0xCC, 0x78, 0xCC, 0xCC, 0x78, 0x00,
	 0x78, 0xCC, 0xCC, 0x7C, 0x0C, 0x18, 0x70, 0x00,
	 0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x00,
	 0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x60,
	 0x18, 0x30, 0x60, 0xC0, 0x60, 0x30, 0x18, 0x00,
	 0x00, 0x00, 0xFC, 0x00, 0x00, 0xFC, 0x00, 0x00,
	 0x60, 0x30, 0x18, 0x0C, 0x18, 0x30, 0x60, 0x00,
	 0x78, 0xCC, 0x0C, 0x18, 0x30, 0x00, 0x30, 0x00,
	 0x7C, 0xC6, 0xDE, 0xDE, 0xDE, 0xC0, 0x78, 0x00,
	 0x30, 0x78, 0xCC, 0xCC, 0xFC, 0xCC, 0xCC, 0x00,
	 0xFC, 0x66, 0x66, 0x7C, 0x66, 0x66, 0xFC, 0x00,
	 0x3C, 0x66, 0xC0, 0xC0, 0xC0, 0x66, 0x3C, 0x00,
	 0xF8, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0xF8, 0x00,
	 0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x7E, 0x00,
	 0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x60, 0x00,
	 0x3C, 0x66, 0xC0, 0xC0, 0xCE, 0x66, 0x3E, 0x00,
	 0xCC, 0xCC, 0xCC, 0xFC, 0xCC, 0xCC, 0xCC, 0x00,
	 0x78, 0x30, 0x30, 0x30, 0x30, 0x30, 0x78, 0x00,
	 0x1E, 0x0C, 0x0C, 0x0C, 0xCC, 0xCC, 0x78, 0x00,
	 0xE6, 0x66, 0x6C, 0x78, 0x6C, 0x66, 0xE6, 0x00,
	 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00,
	 0xC6, 0xEE, 0xFE, 0xFE, 0xD6, 0xC6, 0xC6, 0x00,
	 0xC6, 0xE6, 0xF6, 0xDE, 0xCE, 0xC6, 0xC6, 0x00,
	 0x38, 0x6C, 0xC6, 0xC6, 0xC6, 0x6C, 0x38, 0x00,
	 0xFC, 0x66, 0x66, 0x7C, 0x60, 0x60, 0xF0, 0x00,
	 0x78, 0xCC, 0xCC, 0xCC, 0xDC, 0x78, 0x1C, 0x00,
	 0xFC, 0x66, 0x66, 0x7C, 0x6C, 0x66, 0xE6, 0x00,
	 0x78, 0xCC, 0xE0, 0x70, 0x1C, 0xCC, 0x78, 0x00,
	 0xFC, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x00,
	 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xFC, 0x00,
	 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0x78, 0x30, 0x00,
	 0xC6, 0xC6, 0xC6, 0xD6, 0xFE, 0xEE, 0xC6, 0x00,
	 0xC6, 0xC6, 0x6C, 0x38, 0x38, 0x6C, 0xC6, 0x00,
	 0xCC, 0xCC, 0xCC, 0x78, 0x30, 0x30, 0x78, 0x00,
	 0xFE, 0x06, 0x0C, 0x18, 0x30, 0x60, 0xFE, 0x00,
	 0x78, 0x60, 0x60, 0x60, 0x60, 0x60, 0x78, 0x00,
	 0xC0, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x02, 0x00,
	 0x78, 0x18, 0x18, 0x18, 0x18, 0x18, 0x78, 0x00,
	 0x10, 0x38, 0x6C, 0xC6, 0x00, 0x00, 0x00, 0x00,
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,
	 0x30, 0x30, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00,
	 0x00, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x76, 0x00,
	 0xE0, 0x60, 0x60, 0x7C, 0x66, 0x66, 0xDC, 0x00,
	 0x00, 0x00, 0x78, 0xCC, 0xC0, 0xCC, 0x78, 0x00,
	 0x1C, 0x0C, 0x0C, 0x7C, 0xCC, 0xCC, 0x76, 0x00,
	 0x00, 0x00, 0x78, 0xCC, 0xFC, 0xC0, 0x78, 0x00,
	 0x38, 0x6C, 0x60, 0xF0, 0x60, 0x60, 0xF0, 0x00,
	 0x00, 0x00, 0x76, 0xCC, 0xCC, 0x7C, 0x0C, 0xF8,
	 0xE0, 0x60, 0x6C, 0x76, 0x66, 0x66, 0xE6, 0x00,
	 0x30, 0x00, 0x70, 0x30, 0x30, 0x30, 0x78, 0x00,
	 0x0C, 0x00, 0x0C, 0x0C, 0x0C, 0xCC, 0xCC, 0x78,
	 0xE0, 0x60, 0x66, 0x6C, 0x78, 0x6C, 0xE6, 0x00,
	 0x70, 0x30, 0x30, 0x30, 0x30, 0x30, 0x78, 0x00,
	 0x00, 0x00, 0xCC, 0xFE, 0xFE, 0xD6, 0xC6, 0x00,
	 0x00, 0x00, 0xF8, 0xCC, 0xCC, 0xCC, 0xCC, 0x00,
	 0x00, 0x00, 0x78, 0xCC, 0xCC, 0xCC, 0x78, 0x00,
	 0x00, 0x00, 0xDC, 0x66, 0x66, 0x7C, 0x60, 0xF0,
	 0x00, 0x00, 0x76, 0xCC, 0xCC, 0x7C, 0x0C, 0x1E,
	 0x00, 0x00, 0xDC, 0x76, 0x66, 0x60, 0xF0, 0x00,
	 0x00, 0x00, 0x7C, 0xC0, 0x78, 0x0C, 0xF8, 0x00,
	 0x10, 0x30, 0x7C, 0x30, 0x30, 0x34, 0x18, 0x00,
	 0x00, 0x00, 0xCC, 0xCC, 0xCC, 0xCC, 0x76, 0x00,
	 0x00, 0x00, 0xCC, 0xCC, 0xCC, 0x78, 0x30, 0x00,
	 0x00, 0x00, 0xC6, 0xD6, 0xFE, 0xFE, 0x6C, 0x00,
	 0x00, 0x00, 0xC6, 0x6C, 0x38, 0x6C, 0xC6, 0x00,
	 0x00, 0x00, 0xCC, 0xCC, 0xCC, 0x7C, 0x0C, 0xF8,
	 0x00, 0x00, 0xFC, 0x98, 0x30, 0x64, 0xFC, 0x00,
	 0x1C, 0x30, 0x30, 0xE0, 0x30, 0x30, 0x1C, 0x00,
	 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x00,
	 0xE0, 0x30, 0x30, 0x1C, 0x30, 0x30, 0xE0, 0x00,
     0x76, 0xDC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 0x00, 0x10, 0x38, 0x6C, 0xC6, 0xC6, 0xFE, 0x00
};

void DBG_Initialize( void )
{
	int Index;

	for( Index = 0; Index < 256; ++Index )
	{
		VDP2_CRAM_PTR[ Index ] = DBG_Palette[ Index ];
	}

	VDP2_CRAM_PTR[ 0 ] = VDP2_CRAM_PTR[ 1 ];
	VDP2_CRAM_PTR[ 1 ] = 0x10 << 10;
}

void DBG_PrintChar( int p_X, int p_Y, uint8_t p_Color, char p_Char )
{
	int Row, Column;

	volatile uint8_t *pBitmap = ( volatile uint8_t * )VDP2_VRAM;
	uint8_t Foreground = ( p_Color >> 4 ) & 0x0F;
	uint8_t Background = ( p_Color ) & 0x0F;

	for( Row = 0; Row < 8; ++Row )
	{
		uint8_t B = DBG_Font[ p_Char << 3 | Row ];
		for( Column = 0; Column < 8; ++Column )
		{
			uint8_t D = ( B & ( 0x80 >> Column ) ) ? Foreground : Background;
			pBitmap[ ( ( p_Y << 3 | Row ) << 10 ) +
				( p_X << 3 | Column ) ] = D;
		}
	}
}

void DBG_Print( int p_X, int p_Y, uint8_t p_Color, char *p_pString )
{
	int Index;
	for( Index = 0; p_pString[ Index ] != 0; ++Index )
	{
		DBG_PrintChar( p_X + Index, p_Y, p_Color, p_pString[ Index ] );
	}
}

